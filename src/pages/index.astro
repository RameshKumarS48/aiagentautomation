---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import CategoryFilter from '../components/CategoryFilter.astro';
import AgentCard from '../components/AgentCard.astro';

const agents = await getCollection('agents');

// Build category stats
const categoryMap = new Map<string, number>();
agents.forEach(agent => {
  const cat = agent.data.category;
  categoryMap.set(cat, (categoryMap.get(cat) || 0) + 1);
});

const categories = Array.from(categoryMap.entries())
  .map(([name, count]) => ({ name, count }))
  .sort((a, b) => b.count - a.count);

// Get featured/recent agents
const featuredAgents = agents
  .sort((a, b) => b.data.last_updated.getTime() - a.data.last_updated.getTime())
  .slice(0, 12);
---

<BaseLayout
  title="Discover the Best AI Agents"
  description="The most comprehensive directory of AI agents and automation tools. Find documentation, workflows, and technical details for 250+ AI agents."
>
  <Hero agentCount={agents.length} categoryCount={categories.length} />

  <CategoryFilter categories={categories} />

  <!-- Featured Agents -->
  <section class="py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between mb-8">
        <div>
          <h2 class="font-display text-2xl font-bold text-text-primary">Featured Agents</h2>
          <p class="text-text-secondary mt-1">Recently updated and popular AI agents</p>
        </div>
        <a href="/agents/" class="btn-secondary text-sm">
          View All &rarr;
        </a>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {featuredAgents.map(agent => (
          <AgentCard
            name={agent.data.name}
            slug={agent.slug}
            description={agent.data.description}
            category={agent.data.category}
            isOpenSource={agent.data.is_open_source}
            sourceUrl={agent.data.source_url}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="py-16 border-t border-dark-border">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
        <div class="text-center">
          <div class="font-display text-4xl font-bold gradient-text mb-2">{agents.length}+</div>
          <div class="text-text-secondary">AI Agents</div>
        </div>
        <div class="text-center">
          <div class="font-display text-4xl font-bold gradient-text mb-2">{categories.length}</div>
          <div class="text-text-secondary">Categories</div>
        </div>
        <div class="text-center">
          <div class="font-display text-4xl font-bold gradient-text mb-2">Weekly</div>
          <div class="text-text-secondary">Updates</div>
        </div>
        <div class="text-center">
          <div class="font-display text-4xl font-bold gradient-text mb-2">Free</div>
          <div class="text-text-secondary">Forever</div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-16">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <div class="card p-12">
        <h2 class="font-display text-3xl font-bold text-text-primary mb-4">
          Know an AI Agent We're Missing?
        </h2>
        <p class="text-text-secondary mb-8 max-w-xl mx-auto">
          Help us build the most comprehensive AI agents directory. Submit your favorite tools and agents.
        </p>
        <a href="/submit/" class="btn-primary">
          Submit an Agent
        </a>
      </div>
    </div>
  </section>
</BaseLayout>
