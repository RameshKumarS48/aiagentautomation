---
interface Props {
  name: string;
  slug: string;
  description: string;
  category: string;
  isOpenSource?: string;
  sourceUrl?: string;
}

import { slugify } from '../utils/slugify';

const { name, slug, description, category, isOpenSource, sourceUrl } = Astro.props;

// Generate placeholder logo with first letter (safe for emojis)
const initial = Array.from(name)[0];

// Clean category name (remove markdown links)
const cleanCategory = category.replace(/\[([^\]]+)\]\([^)]+\)/g, '$1').trim();
---

<article class="card gradient-border group relative">
  <div class="flex items-start gap-4">
    <!-- Logo placeholder -->
    <div class="w-12 h-12 rounded-xl bg-gradient-accent flex items-center justify-center
                text-white font-display font-bold text-lg flex-shrink-0
                transition-transform duration-300 group-hover:scale-110">
      {initial}
    </div>

    <div class="flex-1 min-w-0">
      <!-- Name and badge -->
      <div class="flex items-center gap-2 mb-1">
        <h3 class="font-display font-semibold text-text-primary truncate">
          <a href={`/agents/${slug}/`} class="focus:outline-none">
            <!-- Stretched link with z-index to cover static content -->
            <span class="absolute inset-0 z-0" aria-hidden="true"></span>
            {name}
          </a>
        </h3>
        {isOpenSource === 'Yes' && (
          <span class="flex-shrink-0 px-2 py-0.5 text-xs font-medium rounded-full
                       bg-green-500/10 text-green-400 border border-green-500/20 relative z-10">
            OSS
          </span>
        )}
      </div>

      <!-- Category tag -->
      <a href={`/categories/${slugify(cleanCategory)}/`} 
         class="inline-block px-2 py-0.5 text-xs rounded-full
              bg-accent-blue/10 text-accent-blue mb-2 hover:bg-accent-blue/20 transition-colors relative z-10">
        {cleanCategory}
      </a>

      <!-- Description -->
      <p class="text-sm text-text-secondary line-clamp-2 mb-4 relative z-0 pointer-events-none">
        {description.slice(0, 120)}{description.length > 120 ? '...' : ''}
      </p>

      <!-- Actions -->
      <div class="flex items-center gap-3">
        <span class="text-sm font-medium text-accent-blue group-hover:text-accent-cyan transition-colors relative z-0 pointer-events-none">
          View Details
          <span class="inline-block transition-transform group-hover:translate-x-1">&rarr;</span>
        </span>
        {sourceUrl && sourceUrl.startsWith('http') && (
          <a href={sourceUrl}
             target="_blank"
             rel="noopener noreferrer"
             class="text-sm text-text-muted hover:text-text-secondary transition-colors relative z-10">
            Visit
          </a>
        )}
      </div>
    </div>
  </div>
</article>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
